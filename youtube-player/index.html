<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>OBS YouTube Player</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap"
			rel="stylesheet"
		/>
		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
				overflow: hidden;
				background: transparent;
				font-family: "Nunito", sans-serif;
			}
			#player-container {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
			#yt-player {
				width: 100%;
				height: 100%;
			}
			#status {
				position: absolute;
				top: 10px;
				left: 10px;
				color: white;
				text-shadow: 1px 1px 2px black;
				font-size: 14px;
				z-index: 100;
			}
		</style>
	</head>
	<body>
		<div id="player-container">
			<div id="status">Initializing...</div>
			<div id="yt-player"></div>
		</div>

		<script>
			// 1. Загрузка YouTube API
			const loadYouTubeAPI = () => {
				const tag = document.createElement("script");
				tag.src = "https://www.youtube.com/iframe_api";
				const firstScriptTag = document.getElementsByTagName("script")[0];
				firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
			};

			// 2. Парсинг параметров URL
			const getParams = () => {
				const url = new URL(window.location.href);
				return {
					list: url.searchParams.get("list"),
					w: Math.min(Number(url.searchParams.get("w")) || 1920, 3840),
					h: Math.min(Number(url.searchParams.get("h")) || 1080, 2160),
					loop: url.searchParams.get("loop") === "true",
					random: url.searchParams.get("random") === "true",
					quality: url.searchParams.get("quality") || "hd1080",
					forcequality: url.searchParams.get("forcequality") === "true",
					speed: Math.min(
						Math.max(Number(url.searchParams.get("speed")) || 1.0, 0.25),
						2
					),
					volume: Math.min(
						Math.max(Number(url.searchParams.get("volume")) || 50, 0),
						100
					),
					fade: url.searchParams.get("fade") === "true",
					title: url.searchParams.get("title") === "true",
					controls: url.searchParams.get("controls") === "true",
					hide: url.searchParams.get("hide") === "true",
					hideWhenStopped: url.searchParams.get("hideWhenStopped") === "true",
				};
			};

			// 3. Инициализация плеера
			let player;
			window.onYouTubeIframeAPIReady = () => {
				document.getElementById("status").textContent = "API loaded";

				const params = getParams();
				if (!params.list) {
					document.getElementById("status").textContent =
						"ERROR: Missing playlist ID (list parameter)";
					return;
				}

				player = new YT.Player("yt-player", {
					width: params.w,
					height: params.h,
					playerVars: {
						listType: "playlist",
						list: params.list,
						autoplay: 1,
						controls: params.controls ? 1 : 0,
						modestbranding: 1,
						rel: 0,
						fs: 0,
						disablekb: 1,
						iv_load_policy: 3,
						cc_load_policy: 0,
						enablejsapi: 1,
						playsinline: 1,
						origin: location.origin,
					},
					events: {
						onReady: (event) => {
							event.target.setVolume(params.volume);
							event.target.setPlaybackRate(params.speed);

							if (params.random) {
								event.target.setShuffle(true);
								event.target.nextVideo();
							}

							if (params.hide) {
								document.getElementById("yt-player").style.display = "none";
							}

							document.getElementById("status").textContent = "Ready";
						},
						onStateChange: (event) => {
							if (params.hideWhenStopped) {
								const states = [YT.PlayerState.ENDED, YT.PlayerState.PAUSED];
								document.getElementById("yt-player").style.display =
									states.includes(event.data) ? "none" : "block";
							}
						},
						onError: (error) => {
							console.error("Player error:", error.data);
							document.getElementById("status").textContent = `Error: ${error.data}`;
						},
					},
				});
			};

			// 4. Запуск приложения
			loadYouTubeAPI();
		</script>
	</body>
</html>
